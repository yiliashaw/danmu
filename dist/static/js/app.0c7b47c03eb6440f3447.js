webpackJsonp([1],{NHnr:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("7+uW"),a={props:{content:{type:String},duration:{type:Number},fontSize:{type:Number}},data:function(){return{}},mounted:function(){}},s={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"text",style:{"animation-duration":this.duration/1e3+"s",fontSize:this.fontSize+"px"}},[this._v("\n  "+this._s(this.content)+"\n")])},staticRenderFns:[]};var o=e("VU/8")(a,s,!1,function(t){e("WnUY")},"data-v-b2c141f8",null).exports,r=e("Zx67"),u=e.n(r),d=e("Zrlr"),c=e.n(d),l=e("wxAW"),h=e.n(l),f=e("zwoO"),v=e.n(f),p=e("Pf15"),m=e.n(p),g=0,k=function(){function t(n){var e=n.id,i=void 0===e?0:e,a=n.content,s=void 0===a?"":a,o=n.fontSize,r=void 0===o?36:o,u=n.duration,d=void 0===u?5e3:u,l=n.windowWidth,h=void 0===l?750:l,f=n.owner,v=void 0!==f&&f;c()(this,t),this.id=i,this.content=s,this.fontSize=r,this.duration=d,this.windowWidth=h,this.owner=v,this.startTime=null,this.endTime=null,this.speed=0,this.width=0,this.left=100,this.state=g,this.parent=null,this.init()}return h()(t,[{key:"init",value:function(){this.width=this.content.length*this.fontSize,this.speed=this.windowWidth/this.duration}},{key:"start",value:function(){this.state=1,this.startTime=Date.now(),this.endTime=this.startTime+this.duration,console.log("开始动--》",this.id,this.endTime-this.startTime,this.width,this.windowWidth)}},{key:"isExpired",value:function(){return 1===this.state&&Date.now()>this.endTime}},{key:"offsetFromX",value:function(){return(Date.now()-this.startTime)*this.speed-this.width}}]),t}(),w=function(){function t(n){var e=n.id,i=n.top;c()(this,t),this.id=e,this.top=i,this.children=[]}return h()(t,[{key:"canAddChild",value:function(){return!!(this.children&&this.children.length<=0)||this.children[this.children.length-1].offsetFromX()>2}},{key:"addChild",value:function(t){this.children.push(t),t.top=this.top,t.start()}},{key:"removeChild",value:function(t){var n=this.children.indexOf(t);this.children.splice(n,1)}},{key:"lastChild",value:function(){return this.children[this.children.length-1]}},{key:"removeAllChildren",value:function(){this.children.splice(0,this.children.length)}},{key:"garbageCollect",value:function(){var t=this;this.children.forEach(function(n){n.isExpired()&&(console.log("垃圾回收--》",n.id,n.startTime,Date.now()),t.removeChild(n))})}}]),t}(),y=e("BzvE"),C=new(function(t){function n(t){c()(this,n);var e=v()(this,(n.__proto__||u()(n)).call(this));return e.pending=[],e.tracks=[],e.init(),e.currentID=0,e}return m()(n,t),h()(n,[{key:"getIdleTrack",value:function(){return this.tracks.find(function(t){return t.canAddChild()})}},{key:"isWindowClear",value:function(){return this.tracks.every(function(t){var n=t.lastChild();return!n||n.isExpired()})}},{key:"totalMessageCount",value:function(){return this.tracks.map(function(t){return t.children.length}).reduce(function(t,n){return t+n})}},{key:"addMessage",value:function(t){var n=this.getIdleTrack();return!!n&&(console.log("add:",t.id),n.addChild(t),this.emit("update"),!0)}},{key:"nextID",value:function(){var t=this.currentID+1;return this.currentID=t,t}},{key:"add",value:function(t){var n=t.content,e=t.fontSize,i=t.duration,a=t.windowWidth,s=t.owner,o=this.nextID(),r=new k({id:o,content:n+":"+o,fontSize:e,duration:i,windowWidth:a,owner:s});this.addMessage(r)||(console.log("pending:",r.id),r.owner?this.pending.unshift(r):this.pending.push(r))}},{key:"consumePending",value:function(){var t=this,n=[];this.pending.forEach(function(e){t.addMessage(e)||n.push(e)}),this.pending=n}},{key:"getData",value:function(){return this.tracks}},{key:"cleanAll",value:function(){this.pending=[],this.tracks.forEach(function(t){t.removeAllChildren()}),this.emit("update")}},{key:"garbageCollect",value:function(){var t=this;this.tracks.forEach(function(n){n.garbageCollect(),t.emit("update")})}},{key:"gc",value:function(t,n){this.tracks.find(function(t){return t===n}).removeChild(t),this.emit("update")}},{key:"tick",value:function(){this.garbageCollect(),this.consumePending()}},{key:"init",value:function(){for(var t=0;t<5;t++)this.tracks[t]=new w({top:50*t,id:t})}}]),n}(e.n(y).a)),D={components:{Message:o},data:function(){return{message:"发送弹幕",randomDanmu:["哦","你好","我很好","所以你呢","我也非常好","那我知道了哦","可是我还不知道","那你怎么才能知道","这是一个字数递增的","这是一个字数递增的句子","这是一个字数递增的句子啊","这是一个字数递增的句子你好","这是一个字数递增的句子我很好","这是一个字数递增的句子你还好吗","这是一个字数递增的句子我也非常好","这是一个字数递增的句子这是一个字数递增的句子"],list:[],danmuData:[],queue:[],to:null,pushTimer:null}},methods:{addMessage:function(){var t=this.randomDanmu.length,n=this.randomDanmu[Math.floor(Math.random()*t+0)];console.log("push--\x3e"),C.add({content:n,fontSize:18,duration:8e3})},addMessageMultiple:function(t){for(var n=0;n<t;++n)this.addMessage()},cleanDanmu:function(){C.cleanAll(),clearTimeout(this.to)},updateDanmu:function(){this.danmuData=C.getData()},garbageCollect:function(t,n,e){},afterLeave:function(t){console.log("after leave")},leave:function(t){console.log("leave")}},mounted:function(){var t=this;this.updateDanmu(),C.on("update",this.updateDanmu);this.to=setTimeout(function n(){C.tick(),t.to=setTimeout(n,20)},20)}},_={render:function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"action",staticStyle:{display:"flex"}},[e("div",{staticClass:"add",on:{click:function(n){t.addMessageMultiple(15)}}},[t._v(t._s(t.message))]),t._v(" "),e("div",{staticClass:"add",on:{click:t.cleanDanmu}},[t._v("清除弹幕")])]),t._v(" "),e("div",{staticClass:"wrap"},t._l(t.danmuData,function(n){return e("div",{key:n.id,staticClass:"track"},[e("transition-group",{attrs:{name:"left"},on:{leave:t.leave,"after-leave":t.afterLeave}},t._l(n.children,function(n){return e("div",{key:n.id,ref:"messages",refInFor:!0,staticClass:"text",style:{"animation-duration":n.duration/1e3+"s",fontSize:n.fontSize+"px"}},[t._v("\n            "+t._s(n.content)+"\n            ")])}))],1)}))])},staticRenderFns:[]};var T=e("VU/8")(D,_,!1,function(t){e("vRbj")},null,null).exports;i.a.config.productionTip=!1,new i.a({el:"#app",components:{App:T},template:"<App/>"})},WnUY:function(t,n){},vRbj:function(t,n){}},["NHnr"]);
//# sourceMappingURL=app.0c7b47c03eb6440f3447.js.map